C51 COMPILER V9.60.0.0   TIMER                                                             06/20/2021 15:27:16 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN .\Objects\timer.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Driver\timer.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common
                    -;..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\timer.lst) OBJECT(.\Objects\timer.obj)

line level    source

   1          /*
   2           *  time.c
   3           *
   4           *  Created on: Dec 25, 2020
   5           *      Author: Truong VV
   6           */
   7          
   8          #include "N76E003.h"
   9          #include "SFR_Macro.h"
  10          #include "Function_Define.h"
  11          #include "soft_uart.h"
  12          #include "gpio.h"
  13          #include "timer.h"
  14          
  15          /******************************************************************************/
  16          /*                              DECLARE AND DEFINE                                      */
  17          /******************************************************************************/
  18          
  19          type_TimerCallBackFnc p_timerCallBack;
  20          /******************************************************************************/
  21          /*                              FUNCTION                                      */
  22          /******************************************************************************/
  23          /**
  24           * @func   PWM_Start
  25           * @brief  None
  26           * @param  
  27           * @retval None
  28           */
  29          void TIMER_Init(TimerChanel channel)
  30          {
  31   1          switch (channel)
  32   1          {
  33   2          case TIMER0:
  34   2              CKCON |= (1 << 3); // clock source of Timer 0 is direct the system clock
  35   2              TMOD |= (1 << 0); // timer0 16bit
  36   2              //WARNING
  37   2              // Timer 2 should be used to avoid resetting registers TH0 and TL0 in the 
  38   2              TL0 =  0xEA;  // = 65535 - 16000000/1200 = 52202
  39   2              TH0 =  0xCB;  // 65535 - 16000000/1200
  40   2              break;
  41   2          case TIMER1:
  42   2              break;
  43   2          case TIMER2:
  44   2              break;
  45   2          case TIMER3:
  46   2              break;
  47   2          default:
  48   2              break;
  49   2          }
  50   1          TIMER_Disable();
  51   1      }
  52          
  53          /**
  54           * @func   PWM_Start
C51 COMPILER V9.60.0.0   TIMER                                                             06/20/2021 15:27:16 PAGE 2   

  55           * @brief  None
  56           * @param  
  57           * @retval None
  58           */
  59          void TIMER_CallBackInit(type_TimerCallBackFnc pHandle)
  60          {
  61   1          p_timerCallBack = pHandle;
  62   1      }
  63          
  64          /**
  65           * @func   PWM_Start
  66           * @brief  None
  67           * @param  
  68           * @retval None
  69           */
  70          static void TIMER_Enable_Select(TimerChanel channel)
  71          {
  72   1          switch (channel)
  73   1          {
  74   2          case TIMER0:
  75   2              TCON  |= (1 << 4); // enable timer0
  76   2              break;
  77   2          case TIMER1:
  78   2              TCON  |= (1 << 6); // enable timer1
  79   2          case TIMER2:
  80   2              T2CON |= (1 << 2); // enable time2
  81   2          case TIMER3:
  82   2              T3CON |= (1 << 3); // enable time3
  83   2          default:
  84   2              break;
  85   2          }
  86   1      }
  87          
  88          void TIMER_Enable(void)
  89          {
  90   1          TIMER_Enable_Select(TIMER0);
  91   1      }
  92          /**
  93           * @func   PWM_Start
  94           * @brief  None
  95           * @param  
  96           * @retval None
  97           */
  98          static void TIMER_Disable_Select(TimerChanel channel)
  99          {
 100   1          switch (channel)
 101   1          {
 102   2          case TIMER0:
 103   2              TCON  &= ~(1 << 4); // enable timer0
 104   2              break;
 105   2          case TIMER1:
 106   2              TCON  &= ~(1 << 6); // enable timer1
 107   2          case TIMER2:
 108   2              T2CON &= ~(1 << 2); // enable time2
 109   2          case TIMER3:
 110   2              T3CON &= ~(1 << 3); // enable time3
 111   2          default:
 112   2              break;
 113   2          }
 114   1      }
 115          
 116          void TIMER_Disable(void)
C51 COMPILER V9.60.0.0   TIMER                                                             06/20/2021 15:27:16 PAGE 3   

 117          {
 118   1          TIMER_Disable_Select(TIMER0);
 119   1      }
 120          /**
 121           * @func   Timer0Overflow_ISR
 122           * @brief  None
 123           * @param  
 124           * @retval None
 125           */
 126          void Timer0Overflow_ISR(void) interrupt 1
 127          {
 128   1          if(p_timerCallBack != NULL)
 129   1          {
 130   2              p_timerCallBack();
 131   2          }
 132   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    292    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      9    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
