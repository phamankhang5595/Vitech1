C51 COMPILER V9.60.0.0   SOFT_UART                                                         05/22/2021 13:57:47 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE SOFT_UART
OBJECT MODULE PLACED IN .\Objects\soft_uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Driver\soft_uart.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Co
                    -mmon;..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\soft_uart.lst) OBJECT(.\Objects\soft_uart.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_Define.h"
   4          #include "timer.h"
   5          #include "soft_uart.h"
   6          
   7          #define SET_LOW() (clr_P02)
   8          #define SET_HIGH() (set_P02)
   9          
  10          
  11          static volatile uint32_t tickCount;
  12          
  13          static void SOFT_UART_PinInit()
  14          {
  15   1          P02_PushPull_Mode;
  16   1          P0SR |= (1 << 2);
  17   1          SET_HIGH();
  18   1      }
  19          
  20          void TICK_Count(void)
  21          {
  22   1          tickCount++;
  23   1         /*  WARNING
  24   1          Timer 2 should be used to avoid resetting registers TH0 and TL0 in the handler function */
  25   1          TCON  &= ~(1 << 4);             // turn off timer
  26   1          TL0 =  0xEA;                    //resetting
  27   1          TH0 =  0xCB;    
  28   1          TCON  |= (1 << 4);              //turn on timer
  29   1      }
  30          
  31          static uint32_t Handle_Tick(void)
  32          {
  33   1          return tickCount;
  34   1      }
  35          
  36          void SOFT_UART_Init(uint16_t baudRate)
  37          {
  38   1          CKSWT |= (1 << 5);
  39   1          CKSWT &= ~(1 << 3);
  40   1          CKSWT &= ~(3 << 1);
  41   1          CKEN |= (1 << 5);
  42   1          
  43   1          TIMER_Init(TIMER0,baudRate);
  44   1          set_ET0;
  45   1          SOFT_UART_PinInit();
  46   1          TIMER_CallBackInit(TICK_Count);
  47   1          TIMER_Enable(TIMER0);
  48   1      }
  49          
  50          void SOFT_UART_SendByte(uint8_t dataByte)
  51          {
  52   1          int i;
  53   1          uint8_t buff[8];
  54   1          SET_HIGH();
C51 COMPILER V9.60.0.0   SOFT_UART                                                         05/22/2021 13:57:47 PAGE 2   

  55   1          //SET_LOW();
  56   1          for(i = 0; i < 8; i++)
  57   1          {
  58   2              buff[i]=(dataByte >> i)&(1U);
  59   2          }
  60   1          tickCount = 0;
  61   1          while(Handle_Tick() != 1);
  62   1          SET_LOW();
  63   1          //SET_HIGH();
  64   1          
  65   1          for(i = 0; i < 8; i++)
  66   1          {
  67   2              while (Handle_Tick() == i+1);
  68   2              if(buff[i] == 1)
  69   2              {
  70   3                  SET_HIGH();
  71   3                  //SET_LOW();
  72   3              }else
  73   2              {
  74   3                  SET_LOW();
  75   3                 // SET_HIGH();
  76   3              }
  77   2          }
  78   1          while (Handle_Tick() == 9);
  79   1          SET_HIGH();
  80   1          //SET_LOW();
  81   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    396    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     17    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
