C51 COMPILER V9.60.0.0   UART                                                              05/09/2021 03:16:57 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\uart.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Driver\uart.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common;
                    -..\Driver;..\Utilities;..\Mid) DEBUG OBJECTEXTEND PRINT(.\Listings\uart.lst) TABS(2) OBJECT(.\Objects\uart.obj)

line level    source

   1          /*
   2           * Copyright (c) 2021
   3           * Team, JSC.
   4           * All Rights Reserved
   5           *
   6           *
   7           * Description:
   8           *
   9           * Author: Truongvv
  10           *
  11           * Last Changed By:  $Author: Truongvv $
  12           * Revision:         $Revision: 1.0 $
  13           * Last Changed:     $Date: x/x/xxxx $
  14           */
  15          #include "N76E003.h"
  16          #include "SFR_Macro.h"
  17          #include "Function_Define.h"
  18          #include "uart.h"
  19          
  20          type_UartCallBackFnc    p_uartCallBack = NULL;
  21          
  22          /**
  23           * @func   UART_Init
  24           * @brief  None
  25           * @param  
  26           * @retval None
  27           */
  28          void UART_Init (uint32_t baudRate) //use timer3 as Baudrate generator
  29          {
  30   1          P06_Quasi_Mode;        //Setting UART pin as Quasi mode for transmit
  31   1          P07_Quasi_Mode;        //Setting UART pin as Quasi mode for transmit    
  32   1      
  33   1          //#ifdef FOSC_160000
  34   1          RH3    = HIBYTE(65536 - (1000000/baudRate)-1);          /*16 MHz */
  35   1          RL3    = LOBYTE(65536 - (1000000/baudRate)-1);            /*16 MHz */
  36   1          //#endif
  37   1      //    #ifdef FOSC_166000
  38   1      //        RH3    = HIBYTE(65536 - (1037500/baudRate));              /*16.6 MHz */
  39   1      //        RL3    = LOBYTE(65536 - (1037500/baudRate));                /*16.6 MHz */
  40   1      //    #endif
  41   1      
  42   1          SCON = 0x70;     //UART0 Mode1
  43   1          set_SMOD;        //UART0 Double Rate Enable
  44   1          T3CON &= 0xF8;   //T3PS2=0,T3PS1=0,T3PS0=0(Prescale=1)
  45   1          set_BRCK;        //UART0 baud rate clock source = Timer3
  46   1          set_TR3;         //Trigger Timer3
  47   1          UART_Disable();
  48   1      }
  49          
  50          /**
  51           * @func   UART_Enable
  52           * @brief  None
  53           * @param  
  54           * @retval None
C51 COMPILER V9.60.0.0   UART                                                              05/09/2021 03:16:57 PAGE 2   

  55           */
  56          void UART_Enable(void)
  57          {
  58   1          set_ES;
  59   1      }
  60          
  61          /**
  62           * @func   UART_Disable
  63           * @brief  None
  64           * @param  
  65           * @retval None
  66           */
  67          void UART_Disable(void)
  68          {
  69   1          clr_ES;
  70   1      }
  71          
  72          
  73          /**
  74           * @func   UART_SendByte
  75           * @brief  None
  76           * @param  
  77           * @retval None
  78           */
  79          void UART_SendByte (u8 byte)
  80          {
  81   1        u8 byteReverse;
  82   1          TI = 0;
  83   1        byteReverse = byte^0xFF;
  84   1          SBUF = byte;
  85   1          while(TI==0);
  86   1      }
  87          
  88          /**
  89           * @func   UART_SendData
  90           * @brief  None
  91           * @param  
  92           * @retval None
  93           */
  94          void UART_SendData (u8* buff, u8 length)
  95          {
  96   1          u8 i;
  97   1          for(i = 0; i < length; i++)
  98   1          {
  99   2              UART_SendByte (buff[i]);
 100   2          }
 101   1      }
 102          
 103          /**
 104           * @func   UART_RevData
 105           * @brief  None
 106           * @param  
 107           * @retval None
 108           */
 109          u8 UART_RevData (void)
 110          {
 111   1          u8 dataRx;
 112   1          dataRx = SBUF;
 113   1          return dataRx;
 114   1      }
 115          
 116          /**
C51 COMPILER V9.60.0.0   UART                                                              05/09/2021 03:16:57 PAGE 3   

 117           * @func   MODIFY_Hirc166
 118           * @brief  None
 119           * @param  
 120           * @retval None
 121           */
 122          void MODIFY_Hirc166(void)
 123          {
 124   1          UINT8 xdata hircmap0,hircmap1;
 125   1          UINT16 xdata trimvalue16bit;
 126   1          // Check if power on reset, modify HIRC 
 127   1          if ((PCON&SET_BIT4)==SET_BIT4)                
 128   1          {
 129   2              hircmap0 = RCTRIM0;
 130   2              hircmap1 = RCTRIM1;
 131   2              trimvalue16bit = ((hircmap0<<1)+(hircmap1&0x01));
 132   2              trimvalue16bit = trimvalue16bit - 15;
 133   2              hircmap1 = trimvalue16bit&0x01;
 134   2              hircmap0 = trimvalue16bit>>1;
 135   2              TA=0XAA;
 136   2              TA=0X55;
 137   2              RCTRIM0 = hircmap0;
 138   2              TA=0XAA;
 139   2              TA=0X55;
 140   2              RCTRIM1 = hircmap1;
 141   2              // Clear power on flag 
 142   2              PCON &= CLR_BIT4;
 143   2          }
 144   1      }
 145          
 146          /**
 147           * @func   UART_CallBackInit
 148           * @brief  None
 149           * @param  
 150           * @retval None
 151           */
 152          void UART_CallBackInit(type_UartCallBackFnc uartCallBackFnc)
 153          {
 154   1          p_uartCallBack = uartCallBackFnc;
 155   1      }
 156          
 157          /**
 158           * @func   SerialPort0_ISR
 159           * @brief  None
 160           * @param  
 161           * @retval None
 162           */
 163          void SerialPort0_ISR(void) interrupt 4
 164          {
 165   1          if(RI == SET)
 166   1          {
 167   2              clr_RI;
 168   2              if(p_uartCallBack != NULL)
 169   2              {
 170   3                  p_uartCallBack();
 171   3              }
 172   2          }
 173   1          if(TI==SET)
 174   1              clr_TI;
 175   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.60.0.0   UART                                                              05/09/2021 03:16:57 PAGE 4   

   CODE SIZE        =    585    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     22    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
