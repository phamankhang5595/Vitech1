C51 COMPILER V9.60.0.0   TICK                                                              06/20/2021 15:27:16 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TICK
OBJECT MODULE PLACED IN .\Objects\tick.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Driver\tick.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common;
                    -..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\tick.lst) OBJECT(.\Objects\tick.obj)

line level    source

   1          #include "Function_Define.h"
   2          #include "N76E003.h"
   3          #include "SFR_Macro.h"
   4          #include "timer.h"
   5          #include "tick.h"
   6          
   7          #define MAX_TICK (2000000000)
   8          static volatile uint32_t tickCount;
   9          
  10          void TICK_Init(void)
  11          {
  12   1          TIMER_Init(TIMER0);
  13   1          TIMER_CallBackInit(TICK_Count);
  14   1          TIMER_Enable();
  15   1      }
  16          
  17          void TICK_Count(void)
  18          {
  19   1          tickCount++;
  20   1          if (tickCount > MAX_TICK)
  21   1          {
  22   2              tickCount = 0;
  23   2          }
  24   1          
  25   1         /*  WARNING
  26   1          Timer 2 should be used to avoid resetting registers TH0 and TL0 in the handler function */
  27   1          TCON  &= ~(1 << 4);             // turn off timer
  28   1          TL0 =  0xEA;                    //resetting
  29   1          TH0 =  0xCB;    
  30   1          TCON  |= (1 << 4);              //turn on timer
  31   1      }
  32          
  33          uint32_t Handle_Tick(void)
  34          {
  35   1          return tickCount;
  36   1      }
  37          
  38          void TICK_Delay_ms(uint32_t time_ms)
  39          {
  40   1          static uint32_t t0, t1;
  41   1          t0 = Handle_Tick();
  42   1          t1 = Handle_Tick();
  43   1          if(t0 < (MAX_TICK - time_ms))
  44   1          {
  45   2              while(t1 - t0 < time_ms)
  46   2              {
  47   3                  t1 = Handle_Tick();
  48   3              }
  49   2          }
  50   1          else
  51   1          {
  52   2              if(t1 > time_ms)
  53   2              {
  54   3                  while(t1 > time_ms)
C51 COMPILER V9.60.0.0   TICK                                                              06/20/2021 15:27:16 PAGE 2   

  55   3                  {
  56   4                      t1 = Handle_Tick();
  57   4                  }
  58   3                  while(MAX_TICK - t0 + t1 < time_ms)
  59   3                  {
  60   4                      t1 = Handle_Tick();
  61   4                  }
  62   3              }
  63   2              else
  64   2              {
  65   3                  while(MAX_TICK - t0 + t1 < time_ms)
  66   3                  {
  67   4                      t1 = Handle_Tick();
  68   4                  }
  69   3              }
  70   2          }
  71   1          return;
  72   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    532    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     16    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
