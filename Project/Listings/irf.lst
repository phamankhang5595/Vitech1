C51 COMPILER V9.60.0.0   IRF                                                               06/20/2021 16:13:19 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE IRF
OBJECT MODULE PLACED IN .\Objects\irf.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Mid\irf.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common;..\D
                    -river;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\irf.lst) OBJECT(.\Objects\irf.obj)

line level    source

   1          /*
   2           * Copyright (c) 2021
   3           * Team, JSC.
   4           * All Rights Reserved
   5           *
   6           *
   7           * Description:
   8           *
   9           * Author: Truongvv
  10           *
  11           * Last Changed By:  $Author: Truongvv $
  12           * Revision:         $Revision: 1.0 $
  13           * Last Changed:     $Date: x/x/xxxx $
  14           */
  15          #include "N76E003.h"
  16          #include "SFR_Macro.h"
  17          #include "Function_Define.h"
  18          #include "irfapp_main.h"
  19          #include "uart.h"
  20          #include "queue.h"
  21          #include "xor.h"
  22          #include "irf.h"
  23          
  24          QUEUEx_t    irf_CommandQueue;
  25          irf_Command_t irf_CommandBuff[IRF_QUEUE_MAX];
  26          extern volatile int checkStopCmd;
  27          /******************************************************************************/
  28          /*                            FUNCTIONS                              */
  29          /******************************************************************************/
  30          static void IRF_CallBackHandle(void);
  31          
  32          /**
  33           * @func    IRF_Init
  34           * @brief   None
  35           * @param   None
  36           */
  37          void IRF_Init(void)
  38          {
  39   1          UART_Init(UART_BAUDRATE);
  40   1          UART_CallBackInit(IRF_CallBackHandle);
  41   1          QUEUE_Init(&irf_CommandQueue, (u8*)&irf_CommandBuff,\
  42   1                      IRF_QUEUE_MAX, sizeof(irf_Command_t));
  43   1          UART_Enable();
  44   1      }
  45          
  46          /**
  47           * @func    IRF_CallBackHandle
  48           * @brief   None
  49           * @param   None
  50           */
  51          static void IRF_CallBackHandle(void)
  52          {
  53   1          static u8 revByte = 0;
  54   1          static u16 revByteCount = 0;
C51 COMPILER V9.60.0.0   IRF                                                               06/20/2021 16:13:19 PAGE 2   

  55   1          static u8 checkError = 0;
  56   1          int i=0;
  57   1          u8 revBuff[IRF_HEADER + IRF_BUFF_MAX + 1];
  58   1          //u8 sendError[5];
  59   1          revByte = UART_RevData();
  60   1          revBuff[revByteCount++] = revByte;
  61   1          /* Check if cmd is stop then do not queue*/
  62   1          if (revBuff[0] == STOP_RUN)
  63   1          {
  64   2              checkStopCmd = 1;
  65   2          }
  66   1           if (revByteCount >= IRF_HEADER) {
  67   2              if(revByteCount == (IRF_HEADER + revBuff[3] + 1))
  68   2              {
  69   3                  if(revBuff[IRF_HEADER + revBuff[3]] == XOR_Caculator(revBuff, 0, IRF_HEADER + revBuff[3]))
  70   3                  {
  71   4                      QUEUE_Push(&irf_CommandQueue, revBuff);
  72   4                  } else {
  73   4                      checkError ++;
  74   4                      UART_SendData("RJ",2);
  75   4                  }
  76   3                  revByteCount = 0;
  77   3              }
  78   2          }
  79   1      }
  80          
  81          /**
  82           * @func    IRF_Proc
  83           * @brief   None
  84           * @param   None
  85           */
  86          void IRF_Proc(void)
  87          {
  88   1          irf_Command_t irf_CommandBuff;
  89   1          if(!QUEUE_Empty(&irf_CommandQueue))
  90   1          {
  91   2              QUEUE_Get(&irf_CommandQueue, (u8*)&irf_CommandBuff);
  92   2              APP_CheckCommandExistAndExecutes(\
  93   2                  irf_CommandBuff.command, irf_CommandBuff.type,\
  94   2                  irf_CommandBuff.buff, irf_CommandBuff.length); 
  95   2          }
  96   1      }
  97          
  98          /**
  99           * @func    IRF_Send
 100           * @brief   None
 101           * @param   None
 102           */
 103          void IRF_Send(u8* buff, u8 length)
 104          {
 105   1          UART_SendData(buff, length);
 106   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    430    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =     84    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.0.0   IRF                                                               06/20/2021 16:13:19 PAGE 3   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
