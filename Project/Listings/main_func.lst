C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/20/2021 16:13:19 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN_FUNC
OBJECT MODULE PLACED IN .\Objects\main_func.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\App\main_func.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Commo
                    -n;..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\main_func.lst) OBJECT(.\Objects\main_func.obj)

line level    source

   1          /*
   2           *      mainfunclist.c
   3           *
   4           *      Created on: Dec 25, 2020
   5           *      Author: Truong VV
   6           */
   7          
   8          #include "N76E003.h"
   9          #include "SFR_Macro.h"
  10          #include "Function_Define.h"
  11          #include "irfapp_main.h"
  12          #include "irf.h"
  13          #include "motor.h"
  14          #include "relay.h"
  15          #include "xor.h"
  16          #include "floor.h"
  17          #include "main_func.h"
  18          
  19          
  20          /******************************************************************************/
  21          /*                              DECLARE                                      */
  22          /******************************************************************************/
  23          
  24          uint8_t checkConnect[]  = {0x20, 0xA1, 0x00, 0x01, 0x0A, 0x8A};
  25          uint8_t startRun[]      = {0x30, 0xA1, 0x00, 0x01, 0x0A, 0x9A};
  26          uint8_t stopRun[]       = {0x40, 0xA1, 0x00, 0x01, 0x0A, 0xEA};
  27          uint8_t updownFloor[]   = {0x50, 0xA1, 0x00, 0x01, 0x0A, 0xFA};
  28          uint8_t getStateMotor[] = {0x70, 0xA1, 0x00, 0x01, 0x72, 0xA2};
  29          uint8_t getStateFloor[] = {0x73, 0xA1, 0x00, 0x01, 0x75, 0xA6};
  30          uint8_t setSpeedMotor[] = {0x80, 0xA1, 0x00, 0x01, 0x0A, 0x2A};
  31          uint8_t getAllState[]   = {0x90, 0xA1, 0x00, 0x02, 0x21, 0x71, 0x63};
  32          uint8_t resetDevice[]   = {0x0F, 0xA1, 0x00, 0x01, 0x0A, 0xA5};
  33          
  34          extern volatile uint8_t deviceAnnounceFlag;
  35          extern volatile uint8_t checkConnectFlag;
  36          extern volatile uint8_t startRunFlag;
  37          extern volatile uint8_t stopRunFlag;
  38          extern volatile uint8_t updownFloorFlag;
  39          extern volatile uint8_t getStateMotorFlag;
  40          extern volatile uint8_t getStateFloorFlag;
  41          extern volatile uint8_t setSpeedMotorFlag;
  42          extern volatile uint8_t getAllStateFlag;
  43          extern volatile uint8_t resetDeviceFlag;
  44          extern volatile uint8_t speedValue;
  45          extern volatile uint8_t floorValue;
  46          
  47          uint16_t currentDuty;
  48          uint8_t stateConnectFlag;
  49          uint8_t stateMotorFlag;
  50          uint8_t stateFloorFlag;
  51          
  52          /******************************************************************************/
  53          /*                              FUNCTION                                      */
  54          /******************************************************************************/
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/20/2021 16:13:19 PAGE 2   

  55          
  56          /**
  57           * @func   funcHandle_AllFlag
  58           * @brief  None
  59           * @param  
  60           * @retval None
  61           */
  62          // void funcHandle_CurrentDuty()
  63          // {
  64          //     
  65          // }
  66           
  67          void funcHandle_AllFlag(void)
  68          {
  69   1          if(deviceAnnounceFlag==1||checkConnectFlag==1||startRunFlag==1||\
  70   1              stopRunFlag==1||updownFloorFlag==1||getStateMotorFlag==1||\
  71   1              getStateFloorFlag==1||setSpeedMotorFlag==1||getAllStateFlag==1)
  72   1          {
  73   2              if(deviceAnnounceFlag == 1)
  74   2              {
  75   3                  funcHandle_DeviceAnnounceFlag();
  76   3                  
  77   3              }else if(checkConnectFlag == 1)
  78   2              {
  79   3                  funcHandle_CheckConnectFlag();  
  80   3      
  81   3              }else if(startRunFlag == 1)
  82   2              {   
  83   3                  funcHandle_StartRunFlag();
  84   3      
  85   3              }else if(stopRunFlag == 1)
  86   2              {
  87   3                  funcHandle_StopRunFlag();
  88   3      
  89   3              }else if(updownFloorFlag == 1)
  90   2              {
  91   3                  funcHandle_UpdownFloorFlag();
  92   3      
  93   3              }else if(getStateMotorFlag == 1)
  94   2              {
  95   3                  funcHandle_GetStateMotorFlag();
  96   3      
  97   3              }else if(getStateFloorFlag == 1)
  98   2              {
  99   3                  funcHandle_GetStateFloorFlag();
 100   3      
 101   3              }else if(setSpeedMotorFlag == 1)
 102   2              {
 103   3                  funcHandle_SetSpeedMotorFlag();
 104   3      
 105   3              }else if(getAllStateFlag == 1)
 106   2              {
 107   3                  funcHandle_GetAllStateFlag();
 108   3      
 109   3              }
 110   2          }
 111   1      }
 112          /**
 113           * @func   funcHandle_DeviceAnnounceFlag
 114           * @brief  None
 115           * @param  
 116           * @retval None
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/20/2021 16:13:19 PAGE 3   

 117           */
 118          void funcHandle_DeviceAnnounceFlag(void)
 119          {
 120   1          deviceAnnounceFlag = 0;
 121   1      }
 122          /**
 123           * @func   funcHandle_CheckConnectFlag
 124           * @brief  None
 125           * @param  
 126           * @retval None
 127           */
 128          void funcHandle_CheckConnectFlag(void)
 129          {
 130   1          checkConnectFlag = 0;
 131   1          IRF_Send(checkConnect, sizeof(checkConnect));
 132   1          stateConnectFlag = 1;
 133   1          
 134   1      }
 135          /**
 136           * @func   funcHandle_StartRunFlag
 137           * @brief  None
 138           * @param  
 139           * @retval None
 140           */
 141          void funcHandle_StartRunFlag(void)
 142          {
 143   1          startRunFlag = 0;
 144   1          IRF_Send(startRun, sizeof(startRun));
 145   1          RELAY_AC(ON);
 146   1          MOTOR_SetSpeed(DEFAULTDUTY, DEFAULTSPEED);
 147   1          currentDuty = DEFAULTSPEED;
 148   1      }
 149          /**
 150           * @func   funcHandle_StopRunFlag
 151           * @brief  None
 152           * @param  
 153           * @retval None
 154           */
 155          void funcHandle_StopRunFlag(void)
 156          {
 157   1          stopRunFlag = 0;
 158   1          //IRF_Send(stopRun, sizeof(stopRun));
 159   1          MOTOR_SetStop(currentDuty);
 160   1          RELAY_AC(OFF);
 161   1      }
 162          /**
 163           * @func   funcHandle_UpdownFloorFlag
 164           * @brief  None
 165           * @param  
 166           * @retval None
 167           */
 168          void funcHandle_UpdownFloorFlag(void)
 169          {
 170   1          updownFloorFlag = 0;
 171   1          FLOOR_UpOrDown(floorValue);
 172   1          //IRF_Send(updownFloor, sizeof(updownFloor));
 173   1      }
 174          
 175          /**
 176           * @func   funcHandle_GetStateMotorFlag
 177           * @brief  None
 178           * @param  
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/20/2021 16:13:19 PAGE 4   

 179           * @retval None
 180           */
 181          void funcHandle_GetStateMotorFlag(void)
 182          {
 183   1          getStateMotorFlag = 0;
 184   1          IRF_Send(getStateMotor, sizeof(getStateMotor));
 185   1      }
 186          /**
 187           * @func   funcHandle_GetStateFloorFlag
 188           * @brief  None
 189           * @param  
 190           * @retval None
 191           */
 192          void funcHandle_GetStateFloorFlag(void)
 193          {
 194   1          getStateFloorFlag = 0;
 195   1          IRF_Send(getStateFloor, sizeof(getStateFloor));
 196   1      }
 197          
 198          /**
 199           * @func   funcHandle_SetSpeedMotorFlag
 200           * @brief  None
 201           * @param  
 202           * @retval None
 203           */
 204          void funcHandle_SetSpeedMotorFlag(void)
 205          {
 206   1          uint16_t desireDuty;
 207   1          setSpeedMotorFlag = 0;
 208   1          IRF_Send(setSpeedMotor, sizeof(setSpeedMotor));
 209   1          desireDuty = speedValue;
 210   1          MOTOR_SetSpeed(currentDuty, desireDuty);
 211   1          currentDuty = MOTOR_GetCurrentSpeed();
 212   1      }
 213          
 214          /**
 215           * @func   funcHandle_GetAllStateFlag
 216           * @brief  None
 217           * @param  
 218           * @retval None
 219           */
 220          void funcHandle_GetAllStateFlag(void)
 221          {
 222   1          getAllStateFlag = 0;
 223   1          /* kiem tra xem co motor hay khong */
 224   1          if(stateConnectFlag == 1)
 225   1          {
 226   2              getAllState[4] = CHECK_CONNECT_SUCCESS;
 227   2          }else {
 228   2              getAllState[4] = CHECK_CONNECT_NOTSUCCESS;
 229   2          }
 230   1          if(stateMotorFlag == 1)
 231   1          {
 232   2              getAllState[5] = IS_HAVEMOTOR;
 233   2          }else {
 234   2              getAllState[5] = IS_NOTMOTOR;
 235   2          }
 236   1          getAllState[6] = XOR_Caculator(getAllState, 0, sizeof(getAllState)-1);
 237   1          IRF_Send(getAllState, sizeof(getAllState));
 238   1      }
 239          
 240          /**
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/20/2021 16:13:19 PAGE 5   

 241           * @func   funcHandle_ResetDeviceFlag
 242           * @brief  None
 243           * @param  
 244           * @retval None
 245           */
 246          //void funcHandle_ResetDeviceFlag(void)
 247          //{
 248          //    resetDeviceFlag = 0;
 249          //    //IRF_Send(resetDevice, sizeof(resetDevice));
 250          
 251          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    573    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     62    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
