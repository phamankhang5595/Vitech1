C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/13/2021 16:48:30 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN_FUNC
OBJECT MODULE PLACED IN .\Objects\main_func.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\App\main_func.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Commo
                    -n;..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\main_func.lst) TABS(2) OBJECT(.\Objects\main_func.o
                    -bj)

line level    source

   1          /*
   2           *      mainfunclist.c
   3           *
   4           *      Created on: Dec 25, 2020
   5           *      Author: Truong VV
   6           */
   7          
   8          #include "N76E003.h"
   9          #include "SFR_Macro.h"
  10          #include "Function_Define.h"
  11          #include "irfapp_main.h"
  12          #include "irf.h"
  13          #include "motor.h"
  14          #include "relay.h"
  15          #include "xor.h"
  16          #include "floor.h"
  17          #include "main_func.h"
  18          
  19          
  20          /******************************************************************************/
  21          /*                              DECLARE                                      */
  22          /******************************************************************************/
  23          
  24          uint8_t checkConnect[]  = {0x20, 0xA1, 0x00, 0x01, 0x0A, 0x8A};
  25          uint8_t startRun[]      = {0x30, 0xA1, 0x00, 0x01, 0x0A, 0x9A};
  26          uint8_t stopRun[]       = {0x40, 0xA1, 0x00, 0x01, 0x0A, 0xEA};
  27          uint8_t updownFloor[]   = {0x50, 0xA1, 0x00, 0x01, 0x0A, 0xFA};
  28          uint8_t getStateMotor[] = {0x70, 0xA1, 0x00, 0x01, 0x72, 0xA2};
  29          uint8_t getStateFloor[] = {0x73, 0xA1, 0x00, 0x01, 0x75, 0xA6};
  30          uint8_t setSpeedMotor[] = {0x80, 0xA1, 0x00, 0x01, 0x0A, 0x2A};
  31          uint8_t getAllState[]   = {0x90, 0xA1, 0x00, 0x02, 0x21, 0x71, 0x63};
  32          uint8_t resetDevice[]   = {0x0F, 0xA1, 0x00, 0x01, 0x0A, 0xA5};
  33          
  34          extern volatile uint8_t deviceAnnounceFlag;
  35          extern volatile uint8_t checkConnectFlag;
  36          extern volatile uint8_t startRunFlag;
  37          extern volatile uint8_t stopRunFlag;
  38          extern volatile uint8_t updownFloorFlag;
  39          extern volatile uint8_t getStateMotorFlag;
  40          extern volatile uint8_t getStateFloorFlag;
  41          extern volatile uint8_t setSpeedMotorFlag;
  42          extern volatile uint8_t getAllStateFlag;
  43          extern volatile uint8_t resetDeviceFlag;
  44          extern volatile uint8_t speedValue;
  45          extern volatile uint8_t floorValue;
  46          
  47          uint16_t currentDuty;
  48          uint8_t stateConnectFlag;
  49          uint8_t stateMotorFlag;
  50          uint8_t stateFloorFlag;
  51          
  52          
  53          /******************************************************************************/
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/13/2021 16:48:30 PAGE 2   

  54          /*                              FUNCTION                                      */
  55          /******************************************************************************/
  56          
  57          /**
  58           * @func   funcHandle_AllFlag
  59           * @brief  None
  60           * @param  
  61           * @retval None
  62           */
  63          // void funcHandle_CurrentDuty()
  64          // {
  65          //     
  66          // }
  67           
  68          void funcHandle_AllFlag(void)
  69          {
  70   1          if(deviceAnnounceFlag==1||checkConnectFlag==1||startRunFlag==1||\
  71   1              stopRunFlag==1||updownFloorFlag==1||getStateMotorFlag==1||\
  72   1              getStateFloorFlag==1||setSpeedMotorFlag==1||getAllStateFlag==1)
  73   1          {
  74   2              if(deviceAnnounceFlag == 1)
  75   2              {
  76   3                  funcHandle_DeviceAnnounceFlag();
  77   3                  
  78   3              }else if(checkConnectFlag == 1)
  79   2              {
  80   3                  funcHandle_CheckConnectFlag();  
  81   3      
  82   3              }else if(startRunFlag == 1)
  83   2              {   
  84   3                  funcHandle_StartRunFlag();
  85   3      
  86   3              }else if(stopRunFlag == 1)
  87   2              {
  88   3                  funcHandle_StopRunFlag();
  89   3      
  90   3              }else if(updownFloorFlag == 1)
  91   2              {
  92   3                  funcHandle_UpdownFloorFlag();
  93   3      
  94   3              }else if(getStateMotorFlag == 1)
  95   2              {
  96   3                  funcHandle_GetStateMotorFlag();
  97   3      
  98   3              }else if(getStateFloorFlag == 1)
  99   2              {
 100   3                  funcHandle_GetStateFloorFlag();
 101   3      
 102   3              }else if(setSpeedMotorFlag == 1)
 103   2              {
 104   3                  funcHandle_SetSpeedMotorFlag();
 105   3      
 106   3              }else if(getAllStateFlag == 1)
 107   2              {
 108   3                  funcHandle_GetAllStateFlag();
 109   3      
 110   3              }
 111   2          }
 112   1      }
 113          /**
 114           * @func   funcHandle_DeviceAnnounceFlag
 115           * @brief  None
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/13/2021 16:48:30 PAGE 3   

 116           * @param  
 117           * @retval None
 118           */
 119          void funcHandle_DeviceAnnounceFlag(void)
 120          {
 121   1          
 122   1      }
 123          /**
 124           * @func   funcHandle_CheckConnectFlag
 125           * @brief  None
 126           * @param  
 127           * @retval None
 128           */
 129          void funcHandle_CheckConnectFlag(void)
 130          {
 131   1          checkConnectFlag = 0;
 132   1          IRF_Send(checkConnect, sizeof(checkConnect));
 133   1          stateConnectFlag = 1;
 134   1          
 135   1      }
 136          /**
 137           * @func   funcHandle_StartRunFlag
 138           * @brief  None
 139           * @param  
 140           * @retval None
 141           */
 142          void funcHandle_StartRunFlag(void)
 143          {
 144   1          startRunFlag = 0;
 145   1          IRF_Send(startRun, sizeof(startRun));
 146   1          RELAY_AC(ON);
 147   1          MOTOR_SetSpeed(DEFAULTDUTY, DEFAULTSPEED);
 148   1          currentDuty = DEFAULTSPEED;
 149   1      }
 150          /**
 151           * @func   funcHandle_StopRunFlag
 152           * @brief  None
 153           * @param  
 154           * @retval None
 155           */
 156          void funcHandle_StopRunFlag(void)
 157          {
 158   1          stopRunFlag = 0;
 159   1          //IRF_Send(stopRun, sizeof(stopRun));
 160   1          MOTOR_SetStop(currentDuty);
 161   1          RELAY_AC(OFF);
 162   1      }
 163          /**
 164           * @func   funcHandle_UpdownFloorFlag
 165           * @brief  None
 166           * @param  
 167           * @retval None
 168           */
 169          void funcHandle_UpdownFloorFlag(void)
 170          {
 171   1          updownFloorFlag = 0;
 172   1          FLOOR_UpOrDown(floorValue);
 173   1          //IRF_Send(updownFloor, sizeof(updownFloor));
 174   1      }
 175          
 176          /**
 177           * @func   funcHandle_GetStateMotorFlag
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/13/2021 16:48:30 PAGE 4   

 178           * @brief  None
 179           * @param  
 180           * @retval None
 181           */
 182          void funcHandle_GetStateMotorFlag(void)
 183          {
 184   1          getStateMotorFlag = 0;
 185   1          IRF_Send(getStateMotor, sizeof(getStateMotor));
 186   1      }
 187          /**
 188           * @func   funcHandle_GetStateFloorFlag
 189           * @brief  None
 190           * @param  
 191           * @retval None
 192           */
 193          void funcHandle_GetStateFloorFlag(void)
 194          {
 195   1          getStateFloorFlag = 0;
 196   1          IRF_Send(getStateFloor, sizeof(getStateFloor));
 197   1      }
 198          
 199          /**
 200           * @func   funcHandle_SetSpeedMotorFlag
 201           * @brief  None
 202           * @param  
 203           * @retval None
 204           */
 205          void funcHandle_SetSpeedMotorFlag(void)
 206          {
 207   1          uint16_t desireDuty;
 208   1          setSpeedMotorFlag = 0;
 209   1          IRF_Send(setSpeedMotor, sizeof(setSpeedMotor));
 210   1          desireDuty = speedValue;
 211   1          MOTOR_SetSpeed(currentDuty, desireDuty);
 212   1          currentDuty = MOTOR_GetCurrentSpeed();
 213   1      }
 214          
 215          /**
 216           * @func   funcHandle_GetAllStateFlag
 217           * @brief  None
 218           * @param  
 219           * @retval None
 220           */
 221          void funcHandle_GetAllStateFlag(void)
 222          {
 223   1          getAllStateFlag = 0;
 224   1          /* kiem tra xem co motor hay khong */
 225   1          if(stateConnectFlag == 1)
 226   1          {
 227   2              getAllState[4] = CHECK_CONNECT_SUCCESS;
 228   2          }else {
 229   2              getAllState[4] = CHECK_CONNECT_NOTSUCCESS;
 230   2          }
 231   1          if(stateMotorFlag == 1)
 232   1          {
 233   2              getAllState[5] = IS_HAVEMOTOR;
 234   2          }else {
 235   2              getAllState[5] = IS_NOTMOTOR;
 236   2          }
 237   1          getAllState[6] = XOR_Caculator(getAllState, 0, sizeof(getAllState)-1);
 238   1          IRF_Send(getAllState, sizeof(getAllState));
 239   1      }
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         06/13/2021 16:48:30 PAGE 5   

 240          
 241          /**
 242           * @func   funcHandle_ResetDeviceFlag
 243           * @brief  None
 244           * @param  
 245           * @retval None
 246           */
 247          //void funcHandle_ResetDeviceFlag(void)
 248          //{
 249          //    resetDeviceFlag = 0;
 250          //    //IRF_Send(resetDevice, sizeof(resetDevice));
 251          
 252          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    568    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     62    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
