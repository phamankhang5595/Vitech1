C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         05/15/2021 18:01:58 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN_FUNC
OBJECT MODULE PLACED IN .\Objects\main_func.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\App\main_func.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Commo
                    -n;..\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\main_func.lst) OBJECT(.\Objects\main_func.obj)

line level    source

   1          /*
   2           *      mainfunclist.c
   3           *
   4           *      Created on: Dec 25, 2020
   5           *      Author: Truong VV
   6           */
   7          
   8          #include "N76E003.h"
   9          #include "SFR_Macro.h"
  10          #include "Function_Define.h"
  11          #include "irfapp_main.h"
  12          #include "irf.h"
  13          #include "motor.h"
  14          #include "relay.h"
  15          #include "xor.h"
  16          #include "main_func.h"
  17          
  18          /******************************************************************************/
  19          /*                              DECLARE                                      */
  20          /******************************************************************************/
  21          
  22          uint8_t checkConnect[]  = {0x20, 0xA1, 0x00, 0x01, 0x0A, 0x8A};
  23          uint8_t startRun[]      = {0x30, 0xA1, 0x00, 0x01, 0x0A, 0x9A};
  24          uint8_t stopRun[]       = {0x40, 0xA1, 0x00, 0x01, 0x0A, 0xEA};
  25          uint8_t updownFloor[]   = {0x50, 0xA1, 0x00, 0x01, 0x0A, 0xFA};
  26          uint8_t getStateMotor[] = {0x70, 0xA1, 0x00, 0x01, 0x72, 0xA2};
  27          uint8_t getStateFloor[] = {0x73, 0xA1, 0x00, 0x01, 0x75, 0xA6};
  28          uint8_t setSpeedMotor[] = {0x80, 0xA1, 0x00, 0x01, 0x0A, 0x2A};
  29          uint8_t getAllState[]   = {0x90, 0xA1, 0x00, 0x02, 0x21, 0x71, 0x63};
  30          uint8_t resetDevice[]   = {0x0F, 0xA1, 0x00, 0x01, 0x0A, 0xA5};
  31          
  32          extern volatile uint8_t deviceAnnounceFlag;
  33          extern volatile uint8_t checkConnectFlag;
  34          extern volatile uint8_t startRunFlag;
  35          extern volatile uint8_t stopRunFlag;
  36          extern volatile uint8_t updownFloorFlag;
  37          extern volatile uint8_t getStateMotorFlag;
  38          extern volatile uint8_t getStateFloorFlag;
  39          extern volatile uint8_t setSpeedMotorFlag;
  40          extern volatile uint8_t getAllStateFlag;
  41          extern volatile uint8_t resetDeviceFlag;
  42          extern volatile uint8_t speedValue;
  43          
  44          uint16_t currentDuty;
  45          uint8_t stateConnectFlag;
  46          uint8_t stateMotorFlag;
  47          uint8_t stateFloorFlag;
  48          
  49          /******************************************************************************/
  50          /*                              FUNCTION                                      */
  51          /******************************************************************************/
  52          
  53          /**
  54           * @func   funcHandle_AllFlag
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         05/15/2021 18:01:58 PAGE 2   

  55           * @brief  None
  56           * @param  
  57           * @retval None
  58           */
  59           void funcHandle_CurrentDuty()
  60           {
  61   1           
  62   1       }
  63           
  64          void funcHandle_AllFlag(void)
  65          {
  66   1          if(deviceAnnounceFlag==1||checkConnectFlag==1||startRunFlag==1||\
  67   1              stopRunFlag==1||updownFloorFlag==1||getStateMotorFlag==1||\
  68   1              getStateFloorFlag==1||setSpeedMotorFlag==1||getAllStateFlag==1)
  69   1          {
  70   2              if(deviceAnnounceFlag == 1)
  71   2              {
  72   3                  funcHandle_DeviceAnnounceFlag();
  73   3                  
  74   3              }else if(checkConnectFlag == 1)
  75   2              {
  76   3                  funcHandle_CheckConnectFlag();
  77   3      
  78   3              }else if(startRunFlag == 1)
  79   2              {   
  80   3                  funcHandle_StartRunFlag();
  81   3      
  82   3              }else if(stopRunFlag == 1)
  83   2              {
  84   3                  funcHandle_StopRunFlag();
  85   3      
  86   3              }else if(updownFloorFlag == 1)
  87   2              {
  88   3                  funcHandle_UpdownFloorFlag();
  89   3      
  90   3              }else if(getStateMotorFlag == 1)
  91   2              {
  92   3                  funcHandle_GetStateMotorFlag();
  93   3      
  94   3              }else if(getStateFloorFlag == 1)
  95   2              {
  96   3                  funcHandle_GetStateFloorFlag();
  97   3      
  98   3              }else if(setSpeedMotorFlag == 1)
  99   2              {
 100   3                  funcHandle_SetSpeedMotorFlag();
 101   3      
 102   3              }else if(getAllStateFlag == 1)
 103   2              {
 104   3                  funcHandle_GetAllStateFlag();
 105   3      
 106   3              }
 107   2          }
 108   1      }
 109          /**
 110           * @func   funcHandle_DeviceAnnounceFlag
 111           * @brief  None
 112           * @param  
 113           * @retval None
 114           */
 115          void funcHandle_DeviceAnnounceFlag(void)
 116          {
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         05/15/2021 18:01:58 PAGE 3   

 117   1          
 118   1      }
 119          /**
 120           * @func   funcHandle_CheckConnectFlag
 121           * @brief  None
 122           * @param  
 123           * @retval None
 124           */
 125          void funcHandle_CheckConnectFlag(void)
 126          {
 127   1          checkConnectFlag = 0;
 128   1          IRF_Send(checkConnect, sizeof(checkConnect));
 129   1          stateConnectFlag = 1;
 130   1          
 131   1      }
 132          /**
 133           * @func   funcHandle_StartRunFlag
 134           * @brief  None
 135           * @param  
 136           * @retval None
 137           */
 138          void funcHandle_StartRunFlag(void)
 139          {
 140   1          startRunFlag = 0;
 141   1          //IRF_Send(startRun, sizeof(startRun));
 142   1          RELAY_AC(ON);
 143   1          MOTOR_SetSpeed(DEFAULTDUTY, DEFAULTSPEED);
 144   1          currentDuty = DEFAULTSPEED;
 145   1      }
 146          /**
 147           * @func   funcHandle_StopRunFlag
 148           * @brief  None
 149           * @param  
 150           * @retval None
 151           */
 152          void funcHandle_StopRunFlag(void)
 153          {
 154   1          stopRunFlag = 0;
 155   1          //IRF_Send(stopRun, sizeof(stopRun));
 156   1          MOTOR_SetStop(currentDuty);
 157   1          RELAY_AC(OFF);
 158   1      }
 159          /**
 160           * @func   funcHandle_UpdownFloorFlag
 161           * @brief  None
 162           * @param  
 163           * @retval None
 164           */
 165          void funcHandle_UpdownFloorFlag(void)
 166          {
 167   1          updownFloorFlag = 0;
 168   1          //IRF_Send(updownFloor, sizeof(updownFloor));
 169   1      }
 170          
 171          /**
 172           * @func   funcHandle_GetStateMotorFlag
 173           * @brief  None
 174           * @param  
 175           * @retval None
 176           */
 177          void funcHandle_GetStateMotorFlag(void)
 178          {
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         05/15/2021 18:01:58 PAGE 4   

 179   1          getStateMotorFlag = 0;
 180   1          IRF_Send(getStateMotor, sizeof(getStateMotor));
 181   1      }
 182          /**
 183           * @func   funcHandle_GetStateFloorFlag
 184           * @brief  None
 185           * @param  
 186           * @retval None
 187           */
 188          void funcHandle_GetStateFloorFlag(void)
 189          {
 190   1          getStateFloorFlag = 0;
 191   1          (getStateFloor, sizeof(getStateFloor));
 192   1      }
 193          
 194          /**
 195           * @func   funcHandle_SetSpeedMotorFlag
 196           * @brief  None
 197           * @param  
 198           * @retval None
 199           */
 200          void funcHandle_SetSpeedMotorFlag(void)
 201          {
 202   1          uint16_t desireDuty;
 203   1          setSpeedMotorFlag = 0;
 204   1          //IRF_Send(setSpeedMotor, sizeof(setSpeedMotor));
 205   1          desireDuty = speedValue;
 206   1          MOTOR_SetSpeed(currentDuty, desireDuty);
 207   1          currentDuty = MOTOR_GetCurrentSpeed();
 208   1      }
 209          
 210          /**
 211           * @func   funcHandle_GetAllStateFlag
 212           * @brief  None
 213           * @param  
 214           * @retval None
 215           */
 216          void funcHandle_GetAllStateFlag(void)
 217          {
 218   1          getAllStateFlag = 0;
 219   1          /* kiem tra xem co motor hay khong */
 220   1          if(stateConnectFlag == 1)
 221   1          {
 222   2              getAllState[4] = CHECK_CONNECT_SUCCESS;
 223   2          }else
 224   1          {
 225   2              getAllState[4] = CHECK_CONNECT_NOTSUCCESS;
 226   2          }
 227   1          if(stateMotorFlag == 1)
 228   1          {
 229   2              getAllState[5] = IS_HAVEMOTOR;
 230   2          }else
 231   1          {
 232   2              getAllState[5] = IS_NOTMOTOR;
 233   2          }
 234   1          getAllState[6] = XOR_Caculator(getAllState, 0, sizeof(getAllState)-1);
 235   1          IRF_Send(getAllState, sizeof(getAllState));
 236   1      }
 237          
 238          /**
 239           * @func   funcHandle_ResetDeviceFlag
 240           * @brief  None
C51 COMPILER V9.60.0.0   MAIN_FUNC                                                         05/15/2021 18:01:58 PAGE 5   

 241           * @param  
 242           * @retval None
 243           */
 244          void funcHandle_ResetDeviceFlag(void)
 245          {
 246   1          resetDeviceFlag = 0;
 247   1          //IRF_Send(resetDevice, sizeof(resetDevice));
 248   1      
 249   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    533    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     62    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
