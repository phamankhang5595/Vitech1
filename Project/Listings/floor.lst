C51 COMPILER V9.60.0.0   FLOOR                                                             06/20/2021 16:13:19 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE FLOOR
OBJECT MODULE PLACED IN .\Objects\floor.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Mid\floor.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common;..
                    -\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\floor.lst) OBJECT(.\Objects\floor.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_Define.h"
   4          #include "adc.h"
   5          #include "gpio.h"
   6          #include "relay.h"
   7          #include "delay.h"
   8          #include "timer.h"
   9          #include "floor.h"
  10          
  11          uint16_t topLimitFloor;
  12          uint16_t botLimitFloor;
  13          uint16_t adc_retval[12];
  14          uint16_t resutlAdc;
  15          
  16          #define DELTA (topLimitFloor - botLimitFloor)
  17          #define ERR  (2)
  18          
  19          static void get_adc_levels()
  20          {
  21   1          int i;
  22   1          for ( i = 0; i < 12; i++)
  23   1          {
  24   2              adc_retval[i] = botLimitFloor + ( i * DELTA) / 12;
  25   2          }
  26   1      }
  27          
  28          void FLOOR_GetTopAndBotLimitValue(void)
  29          {
  30   1      
  31   1          uint16_t newValue = 0;
  32   1          uint16_t tempValue = 0;
  33   1          RELAY_Up();
  34   1          newValue = ADC_ReadResultConvert();
  35   1          while (tempValue != newValue)
  36   1          {
  37   2              tempValue = newValue;
  38   2              delay_us(1000);
  39   2              newValue = ADC_ReadResultConvert();
  40   2          }
  41   1          RELAY_UpReset();
  42   1          topLimitFloor = tempValue;
  43   1          delay_ms(1000);
  44   1      
  45   1          tempValue = 0;
  46   1          RELAY_Down();
  47   1          //newValue = ADC_ReadResultConvert();
  48   1          while (tempValue != newValue)
  49   1          {
  50   2              tempValue = newValue;
  51   2              delay_us(1000);
  52   2              newValue = ADC_ReadResultConvert();
  53   2          }
  54   1          RELAY_DownReset();
C51 COMPILER V9.60.0.0   FLOOR                                                             06/20/2021 16:13:19 PAGE 2   

  55   1          botLimitFloor = tempValue;
  56   1      }
  57          
  58          void FLOOR_Init(void)
  59          {
  60   1          ADC_Init();
  61   1      }
  62          
  63          int FLOOR_UpOrDown(uint16_t desireIncl)
  64          {
  65   1          int i;
  66   1          directionFloor_t dir = F_DEFAULT;
  67   1          uint16_t incline_level[12] = {1,2,3,4,5,6,7,8,9,10,11,12};
  68   1          /* Check input*/
  69   1          if(desireIncl < 1 | desireIncl > 12)
  70   1          {
  71   2              return -1;
  72   2          }
  73   1          /* Get adc value levels base on top limit and bottom limit*/
  74   1          get_adc_levels();
  75   1      
  76   1          /* Convert incline from desire Level to adc value*/
  77   1          for (i = 0; i < 12; i++)
  78   1          {
  79   2              if (desireIncl == incline_level[i])
  80   2              {
  81   3                  desireIncl = adc_retval[i];
  82   3                  break;
  83   3              }
  84   2          }
  85   1          /* Get current value of adc*/
  86   1          resutlAdc = ADC_ReadResultConvert();
  87   1          /*  Check Incline will increase or decrease*/
  88   1          if ( resutlAdc <  desireIncl) {
  89   2              dir = F_UP;
  90   2          }
  91   1          else if( resutlAdc >= ( desireIncl - ERR ) && resutlAdc <= ( desireIncl + ERR )) {
  92   2              return 0;
  93   2          }
  94   1          else {
  95   2              dir = F_DOWN;
  96   2          }
  97   1      
  98   1          switch (dir) {
  99   2          case F_UP:
 100   2              RELAY_DownReset();
 101   2              delay_ms(10);
 102   2              RELAY_Up();
 103   2              do {
 104   3                  resutlAdc = ADC_ReadResultConvert();
 105   3              } while (resutlAdc < desireIncl - ERR);
 106   2      
 107   2              /* Reach desireIncl*/
 108   2              RELAY_UpReset();
 109   2              break;
 110   2          case F_DOWN:
 111   2              RELAY_UpReset();
 112   2              delay_ms(10);
 113   2              RELAY_Down();
 114   2              do {
 115   3                  resutlAdc = ADC_ReadResultConvert();
 116   3              } while (resutlAdc > desireIncl + ERR);
C51 COMPILER V9.60.0.0   FLOOR                                                             06/20/2021 16:13:19 PAGE 3   

 117   2      
 118   2              /* Reach desireIncl*/
 119   2              RELAY_DownReset();
 120   2              break;
 121   2          default:
 122   2              return 0;
 123   2              break;
 124   2          }
 125   1          /* Start run*/
 126   1          return 0;
 127   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    846    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =     65    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
