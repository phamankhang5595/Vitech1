C51 COMPILER V9.60.0.0   FLOOR                                                             06/19/2021 13:57:50 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE FLOOR
OBJECT MODULE PLACED IN .\Objects\floor.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Mid\floor.c LARGE OPTIMIZE(0,SPEED) BROWSE INCDIR(..\App;..\Common;..
                    -\Driver;..\Mid;..\Utilities) DEBUG OBJECTEXTEND PRINT(.\Listings\floor.lst) OBJECT(.\Objects\floor.obj)

line level    source

   1          #include "N76E003.h"
   2          #include "SFR_Macro.h"
   3          #include "Function_Define.h"
   4          #include "adc.h"
   5          #include "gpio.h"
   6          #include "relay.h"
   7          #include "delay.h"
   8          #include "floor.h"
   9          
  10          uint16_t topLimitFloor;
  11          uint16_t botLimitFloor;
  12          uint16_t adc_retval[12];
  13          uint16_t resutlAdc;
  14          
  15          #define DELTA ((topLimitFloor - botLimitFloor))
  16          #define ERR  (2)
  17          
  18          static void get_adc_levels()
  19          {
  20   1          int i;
  21   1          for ( i = 0; i < 12; i++)
  22   1          {
  23   2              adc_retval[i] = botLimitFloor + ( i * DELTA) / 12;
  24   2          }
  25   1      }
  26          
  27          void FLOOR_GetTopAndBotLimitValue(void)
  28          {
  29   1      
  30   1          uint16_t newValue = 0;
  31   1          uint16_t tempValue = 0;
  32   1      
  33   1          delay_ms(1000);
  34   1          RELAY_Up();
  35   1          newValue = ADC_ReadResultConvert();
  36   1          while (tempValue != newValue)
  37   1          {
  38   2              tempValue = newValue;
  39   2              delay_us(1000);
  40   2              newValue = ADC_ReadResultConvert();       
  41   2          }
  42   1          RELAY_UpReset();
  43   1          topLimitFloor = tempValue;
  44   1          delay_ms(10);
  45   1      
  46   1          tempValue = 0;
  47   1          RELAY_Down();
  48   1          //newValue = ADC_ReadResultConvert();
  49   1          while (tempValue != newValue)
  50   1          {
  51   2              tempValue = newValue;
  52   2              delay_us(1000);
  53   2              newValue = ADC_ReadResultConvert();       
  54   2          }
C51 COMPILER V9.60.0.0   FLOOR                                                             06/19/2021 13:57:50 PAGE 2   

  55   1          RELAY_DownReset();
  56   1          botLimitFloor = tempValue;
  57   1      }
  58          
  59          void FLOOR_Init(void)
  60          {
  61   1          ADC_Init();
  62   1          GPIO_CallBackInit(FLOOR_GetTopAndBotLimitValue);
  63   1      }
  64          int FLOOR_UpOrDown(uint16_t desireIncl)
  65          {
  66   1          int i;
  67   1          directionFloor_t dir = F_DEFAULT;
  68   1          uint16_t incline_level[12] = {1,2,3,4,5,6,7,8,9,10,11,12};
  69   1          /* Check input*/
  70   1          if(desireIncl < 1 | desireIncl > 12)
  71   1          {
  72   2              return -1;
  73   2          }
  74   1          /* Get adc value levels base on top limit and bottom limit*/
  75   1          get_adc_levels();
  76   1      
  77   1          /* Convert incline from desire Level to adc value*/
  78   1          for (i = 0; i < 12; i++)
  79   1          {
  80   2              if (desireIncl == incline_level[i])
  81   2              {
  82   3                  desireIncl = adc_retval[i];
  83   3                  break;
  84   3              }
  85   2          }
  86   1          /* Get current value of adc*/
  87   1          resutlAdc = ADC_ReadResultConvert();
  88   1          /*  Check Incline will increase or decrease*/
  89   1          if ( resutlAdc <  desireIncl)
  90   1          {
  91   2              dir = F_UP;
  92   2          }
  93   1          else if( resutlAdc >= ( desireIncl - ERR ) && resutlAdc <= ( desireIncl + ERR ))
  94   1          {
  95   2              return 0;
  96   2          }
  97   1          else
  98   1          {
  99   2              dir = F_DOWN;
 100   2          }
 101   1      
 102   1          switch (dir)
 103   1          {
 104   2          case F_UP:
 105   2              RELAY_DownReset();
 106   2              delay_ms(10);
 107   2              RELAY_Up();
 108   2              do
 109   2              {
 110   3                  resutlAdc = ADC_ReadResultConvert();
 111   3              } while (resutlAdc < desireIncl - ERR);
 112   2      
 113   2              /* Reach desireIncl*/
 114   2              RELAY_UpReset();
 115   2              break;
 116   2          case F_DOWN:
C51 COMPILER V9.60.0.0   FLOOR                                                             06/19/2021 13:57:50 PAGE 3   

 117   2              RELAY_UpReset();
 118   2              delay_ms(10);
 119   2              RELAY_Down();
 120   2              do
 121   2              {
 122   3                  resutlAdc = ADC_ReadResultConvert();
 123   3              } while (resutlAdc > desireIncl + ERR);
 124   2      
 125   2              /* Reach desireIncl*/
 126   2              RELAY_DownReset();
 127   2              break;
 128   2          default:
 129   2              return 0;
 130   2              break;
 131   2          }
 132   1          /* Start run*/
 133   1          return 0;
 134   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    862    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =     65    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
